webpackJsonp([15],{718:function(e,t,i){i(939);var s=i(52)(i(871),i(962),"data-v-ff56e96a",null);e.exports=s.exports},854:function(e,t,i){"use strict";var s=i(276);t.a={findList:function(e){return s.b("/api/v1/role/list",e)},permissionsList:function(e){return s.b("/api/v1/permissions/list",e)},permissionsUpdate:function(e,t){return s.a("/api/v1/role/permissions/update/"+e,t)},permissionsGet:function(e,t){return s.b("/api/v1/role/permissions/"+e,t)}}},871:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i(150),a=i.n(s),r=i(854);i(151);t.default={data:function(){return{loading:!1,permissionsEditLoading:!1,users:[],total:0,page:1,limit:10,currentPage:1,editFormVisible:!1,editPermissionsFormVisible:!1,editId:0,treeData:[],defaultProps:{children:"children",label:"name"}}},methods:{handleSizeChange:function(e){this.limit=e(),this.search()},handleCurrentChange:function(e){this.page=e,this.search()},handleSearch:function(){this.total=0,this.page=1,this.search()},search:function(){var e=this,t={pageNum:e.page,pageSize:e.limit};e.loading=!0,r.a.findList(t).then(function(t){e.loading=!1,t&&t.data&&(e.total=t.data.total,e.users=t.data.list)},function(t){e.loading=!1,e.$message.error({showClose:!0,message:t.toString(),duration:2e3})}).catch(function(t){e.loading=!1,console.log(t),e.$message.error({showClose:!0,message:"请求出现异常",duration:2e3})})},handleDefaultPermissions:function(){var e=this,t={pageNum:e.page,pageSize:100};r.a.permissionsList(t).then(function(t){if(console.log("获取树结构"),e.permissionsLoading=!1,t&&0==t.errorCode){var i=t.data.list,s=[];for(var a in i){var r=i[a];1==Number(r.level)&&(null==r.redirect&&delete r.redirect,r.children=[],s.push(r))}for(var a in i){var o=i[a];if(2==Number(o.level)){var n={};for(var l in s){var d=s[l];if(d.id==o.parentId){n=d;break}}null==o.redirect&&delete o.redirect,n.children.push(o)}}e.treeData=s}},function(t){e.$message.error({showClose:!0,message:t.toString(),duration:2e3})}).catch(function(t){e.$message.error({showClose:!0,message:"请求出现异常",duration:2e3})})},showEditDialog:function(e,t){this.editFormVisible=!0,console.log(t)},showPermissionsDialog:function(e,t){this.editPermissionsFormVisible=!0,this.editId=t.id,this.permissionsEditLoading=!0},editPermissionsSubmit:function(){var e=this,t=e.$refs.tree.getCheckedKeys();e.loading=!0,r.a.permissionsUpdate(e.editId,{keys:t.toString()}).then(function(t){e.loading=!1,t&&0==parseInt(t.errorCode)?(e.$message.success({showClose:!0,message:"修改成功",duration:2e3}),e.editPermissionsFormVisible=!1):e.$message.error({showClose:!0,message:"修改失败",duration:2e3})},function(t){e.loading=!1,e.$message.error({showClose:!0,message:t.toString(),duration:2e3})}).catch(function(t){e.loading=!1,console.log(t),e.$message.error({showClose:!0,message:"请求出现异常",duration:2e3})})}},mounted:function(){this.handleSearch(),this.handleDefaultPermissions()},updated:function(){var e=this;1==e.permissionsEditLoading&&r.a.permissionsGet(e.editId,{}).then(function(t){console.log(a()(t)),e.$refs.tree.setCheckedNodes(t.data)})}}},913:function(e,t,i){t=e.exports=i(700)(),t.push([e.i,"","",{version:3,sources:[],names:[],mappings:"",file:"role.vue",sourceRoot:""}])},939:function(e,t,i){var s=i(913);"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);i(701)("c5d19c8e",s,!0)},962:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-row",{staticClass:"warp"},[i("el-col",{staticClass:"warp-breadcrum",attrs:{span:24}},[i("el-breadcrumb",{attrs:{separator:"/"}},[i("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[i("b",[e._v("首页")])]),e._v(" "),i("el-breadcrumb-item",[e._v("系统管理")]),e._v(" "),i("el-breadcrumb-item",[e._v("管理员列表")])],1)],1),e._v(" "),i("el-col",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"warp-main",attrs:{span:24,"element-loading-text":"拼命加载中"}},[i("el-table",{staticStyle:{width:"100%"},attrs:{stripe:"",data:e.users,"highlight-current-row":""}},[i("el-table-column",{attrs:{type:"index",width:"40"}}),e._v(" "),i("el-table-column",{attrs:{prop:"name",label:"角色",width:"120",sortable:""}}),e._v(" "),i("el-table-column",{attrs:{prop:"remark",label:"备注",sortable:""}}),e._v(" "),i("el-table-column",{attrs:{fixed:"right",width:"280",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{size:"small"},on:{click:function(i){e.showPermissionsDialog(t.$index,t.row)}}},[e._v("编辑权限")]),e._v(" "),i("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(i){e.delRole(t.$index,t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),i("el-col",{staticClass:"toolbar",attrs:{span:24}},[i("el-pagination",{staticStyle:{float:"right"},attrs:{layout:"prev, pager, next","page-size":e.limit,total:e.total},on:{"current-change":e.handleCurrentChange}})],1),e._v(" "),i("el-dialog",{attrs:{title:"编辑权限",visible:e.editPermissionsFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editPermissionsFormVisible=t}}},[i("input",{attrs:{type:"hidden"},domProps:{value:e.editId}}),e._v(" "),i("el-tree",{ref:"tree",attrs:{data:e.treeData,"show-checkbox":"","default-expand-all":"","node-key":"id","highlight-current":"",props:e.defaultProps}}),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{nativeOn:{click:function(t){e.editPermissionsFormVisible=!1}}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){e.editPermissionsSubmit(t)}}},[e._v("提交")])],1)],1)],1)],1)},staticRenderFns:[]}}});
//# sourceMappingURL=15.3f2dbace57fbd957820e.js.map